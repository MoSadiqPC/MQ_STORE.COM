<!DOCTYPE html>
<html lang="{{ session.get('language', 'en') }}">
<head>
    <meta charset="UTF-8"><title>{{ get_text('dashboard') }} - DI NIRO</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <nav>
        <div class="logo"><img src="{{ url_for('static', filename='logo.png') }}" alt="Logo"><h2>{{ get_text('dashboard') }}</h2></div>
        <div class="nav-right">
            <a href="{{ url_for('manage_admins') }}" class="nav-link">{{ get_text('manage_admins') }}</a>
            <div class="theme-switch" id="theme-toggle">☀️</div>
            <a href="{{ url_for('logout') }}" class="sign-in">{{ get_text('logout') }}</a>
        </div>
    </nav>
    <div class="container dashboard">
        <div class="dashboard-header"><h1>{{ get_text('welcome') }}, <span>{{ session.username }}</span></h1></div>
        {% with messages = get_flashed_messages(with_categories=true) %}{% if messages %}{% for category, message in messages %}<div class="flash {{ category }}">{{ message }}</div>{% endfor %}{% endif %}{% endwith %}
        <div class="content-section">
            <h2>{{ get_text('add_new_game') }}</h2>
            <form action="{{ url_for('add_game') }}" method="POST" class="add-form" enctype="multipart/form-data">
                <div class="form-group"><label>Game Name</label><input type="text" name="name" required></div>
                <div class="form-group"><label>Price ($)</label><input type="text" name="price" placeholder="0 for free" required></div>
                <div class="form-group"><label>Description</label><input type="text" name="description" required></div>
                <div class="form-group"><label>Category</label><input type="text" name="category" required></div>
                <div class="form-group"><label>Game Image</label><input type="file" name="image" required></div>
                <div class="form-group"><label>Game Username</label><input type="text" name="game_username"></div>
                <div class="form-group"><label>Game Password</label><input type="text" name="game_password"></div>
                <div class="form-group checkbox"><label for="is_free">Is this a free game?</label><input type="checkbox" id="is_free" name="is_free"></div>
                <button type="submit" class="submit-btn accent-secondary-btn">ADD GAME</button>
            </form>
        </div>
        <div class="content-section">
            <h2>{{ get_text('new_orders') }}</h2>
            <table><thead><tr><th>{{ get_text('customer_name') }}</th><th>{{ get_text('phone') }}</th><th>{{ get_text('game') }}</th><th>{{ get_text('date') }}</th></tr></thead>
                <tbody>
                    {% for order in orders %}
                    <tr><td>{{ order.customer_name }}</td><td>{{ order.customer_phone }}</td><td>{{ order.game_name }}</td><td>{{ order.created_at.split(' ')[0] }}</td></tr>
                    {% else %}<tr><td colspan="4">No new orders yet.</td></tr>{% endfor %}
                </tbody>
            </table>
        </div>
        <div class="content-section">
            <h2>{{ get_text('shop_games') }}</h2>
            <table><thead><tr><th>{{ get_text('game') }}</th><th>{{ get_text('price') }}</th><th>{{ get_text('actions') }}</th></tr></thead>
                <tbody>
                    {% for game in shop_games %}
                    <tr><td>{{ game.name }}</td><td>${{ "%.2f"|format(game.price) }}</td>
                        <td>
                            <a href="{{ url_for('edit_game', game_id=game.id) }}" class="action-btn edit-btn">{{ get_text('edit') }}</a>
                            <form action="{{ url_for('delete_game', game_id=game.id) }}" method="POST" style="display:inline;"><button type="submit" class="action-btn delete-btn">{{ get_text('delete') }}</button></form>
                        </td></tr>
                    {% else %}<tr><td colspan="3">No paid games in the database.</td></tr>{% endfor %}
                </tbody>
            </table>
        </div>
        <div class="content-section">
            <h2>{{ get_text('free_games_title') }}</h2>
            <table><thead><tr><th>{{ get_text('game') }}</th><th>{{ get_text('actions') }}</th></tr></thead>
                <tbody>
                    {% for game in free_games %}
                    <tr><td>{{ game.name }}</td>
                        <td>
                            <a href="{{ url_for('edit_game', game_id=game.id) }}" class="action-btn edit-btn">{{ get_text('edit') }}</a>
                            <form action="{{ url_for('delete_game', game_id=game.id) }}" method="POST" style="display:inline;"><button type="submit" class="action-btn delete-btn">{{ get_text('delete') }}</button></form>
                        </td></tr>
                    {% else %}<tr><td colspan="2">No free games in the database.</td></tr>{% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <script src="{{ url_for('static', filename='main.js') }}"></script>
</body>
</html>